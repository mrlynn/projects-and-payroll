
var global_printer=null;function printmygridGO(obj){global_printer.printGrid(obj);}
function printmygridGOcustom(obj){global_printer.printCustom(obj);}
Ext.onReady(function(){Ext.QuickTips.init();Ext.DatePicker.prototype.startDay=4;Ext.apply(Ext.form.VTypes,{daterange:function(val,field){var date=field.parseDate(val);if(!date){return;}
if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!=this.dateRangeMax.getTime()))){var start=Ext.getCmp(field.startDateField);start.setMaxValue(date);start.validate();this.dateRangeMax=date;}
else if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!=this.dateRangeMin.getTime()))){var end=Ext.getCmp(field.endDateField);end.setMinValue(date);end.validate();this.dateRangeMin=date;}
return true;}});var weekStore=new Ext.data.JsonStore({id:'weekStore',url:'data.php',root:'data',baseParams:{xtable:'week',task:'weekDropDown'},fields:[{name:'week'},{name:'date'}]});weekStore.load;var companyStore=new Ext.data.JsonStore({fieldLabel:'Company',id:'companyStore',url:'data.php',root:'results',baseParams:{xtable:'company',task:'getCompany',start:0,limit:100000},fields:[{name:'company_id',type:'int'},{name:'company_name'}]});var hourRecord=Ext.data.Record.create([{name:'hour_id',mapping:'hour_id'},{name:'company_name',mapping:'company_name'},{name:'user_firstname',mapping:'user_firstname'},{name:'user_lastname',mapping:'user_lastname'},{name:'project_name',mapping:'project_name'},{name:'hour_num',mapping:'hour_num'}]);var hourReader=new Ext.data.JsonReader({root:'results',totalProperty:'total',id:'hour_id'},hourRecord);hourDS=new Ext.data.GroupingStore({id:'hourDS',proxy:new Ext.data.HttpProxy({url:'data.php',method:'POST'}),baseParams:{start:0,limit:10000,task:'daysoff',xtable:'hour'},reader:hourReader,sortInfo:{field:'hour_id',direction:'ASC'},groupField:'company_name'});Ext.ux.grid.GroupSummary.Calculations['totalCost']=function(v,record,field){return v+(record.data.hour_num*record.data.user_regularpay);};var summary=new Ext.ux.grid.GroupSummary();var companyRecord=Ext.data.Record.create([{name:'company_id',mapping:'company_id'},{name:'company_name',mapping:'company_name'}]);var companyReader=new Ext.data.JsonReader({root:'data',totalProperty:'total',id:'company_id'},companyRecord);companyDS=new Ext.data.GroupingStore({id:'companyDS',proxy:new Ext.data.HttpProxy({url:'grid-reconfigure.php',method:'POST'}),baseParams:{task:'readCompany',xtable:'company'},reader:companyReader,sortInfo:{field:'company_id',direction:'ASC'}});function handleDelete(){var selectedKeys=grid.selModel.selections.keys;if(selectedKeys.length>0){Ext.MessageBox.confirm('Message','Do you really want to delete this company?',deleteRecord);}else{Ext.MessageBox.alert('Message','Please select a company to delete');}};function refreshGrid(){hourDS.reload();}
function updateDB(oGrid_Event){if(oGrid_Event.value instanceof Date){var fieldValue=oGrid_Event.value.format('Y-m-d H:i:s');}else{var fieldValue=oGrid_Event.value;}
Ext.Ajax.request({waitMsg:'Saving changes...',url:'grid-reconfigure.php',params:{task:"update",key:company_id,xtable:'company',keyID:oGrid_Event.record.data.company_id,field:oGrid_Event.field,value:fieldValue,originalValue:oGrid_Event.record.modified},failure:function(response,options){Ext.MessageBox.alert('Warning','Oops...');},success:function(response,options){if(oGrid_Event.record.data.company_id==''){var responseData=Ext.util.JSON.decode(response.responseText);var newID=responseData.newID;oGrid_Event.record.set('newRecord','no');oGrid_Event.record.set('company_id',newID);ds.commitChanges();}else{ds.commitChanges();}}});};function handleEdit(editEvent){var gridField=editEvent.field;updateDB(editEvent);if(gridField=='price'){getTax(editEvent);}}
function addRecord(){var r=new companyRecord({company_id:'',company_name:''});hourGrid.stopEditing();companyDS.insert(0,r);hourGrid.startEditing(0,1);};function handleDateRange(start,end){d1=start.format('Y-m-d');if(end){d2=end.format('Y-m-d');}else{d2=d1;}
hourDS.baseParams.startdate=d1;hourDS.baseParams.enddate=d2;hourDS.load({params:{start:0,limit:90}});}
var myMaxDate=Date.parse('today+10years');var weekDropDown=new Ext.form.ComboBox({id:'weekDropDown',triggerAction:'all',store:weekStore,displayField:'week',valueField:'date',labelSeparator:null,fieldLabel:'Week:',listClass:'x-combo-list-small',allowBlank:false});var dateForm1=new Ext.FormPanel({labelWidth:80,frame:true,border:false,baseCls:'x-toolbar',bodyStyle:'padding:3px',items:[weekDropDown]});var companyname_edit=new Ext.form.TextField();var money=function(val){return Ext.util.Format.number(val,'$?0,000.00?');}
var hourColumnModel=new Ext.grid.ColumnModel([{header:"ID",width:20,dataIndex:'company_id',sortable:true,hidden:true},{header:"Company",width:190,dataIndex:'company_name',sortable:true,hidden:false},{header:"First Name",width:190,dataIndex:'user_firstname',sortable:true,hidden:false},{header:"Last Name",width:190,dataIndex:'user_lastname',sortable:true,hidden:false},{header:"Type",width:190,dataIndex:'project_name',sortable:true,hidden:false},{header:"Total Hours",width:190,align:'right',dataIndex:'hour_num',sortable:true,hidden:false}]);var startDate=new Ext.form.DateField({format:'Y-m-d',fieldLabel:'From Date',id:'startDate',name:'startDate',width:140,allowBlank:false,vtype:'daterange',emptyText:'From Date...',endDateField:'endDate'});var endDate=new Ext.form.DateField({format:'Y-m-d',fieldLabel:'To Date',id:'endDate',name:'endDate',width:140,allowBlank:false,vtype:'daterange',emptyText:'To Date...',startDateField:'startDate'});var datePicker=new Ext.menu.DateMenu({usePickerPlus:true,noOfMonth:1,markWeekends:true,multiSelection:true,markNationalHolidays:true,useQuickTips:false,strictRangeSelect:true,renderTodayButton:true,showToday:false,handler:function(dp,date){var allStringDates=[];var dateParam='';if(Ext.isDate(date)){allStringDates.push(date.format('Y-m-d'));}else{Ext.each(date,function(c){allStringDates.push(c.format('Y-m-d'));},this);}
for(var i=0;i<allStringDates.length;i++){if(i==0){dateParam=allStringDates[i];}else{dateParam=dateParam+','+allStringDates[i];}}
company_id=Ext.getCmp('company_id');hourDS.baseParams.company_id=company_id.value;hourDS.baseParams.dateParam=dateParam;hourDS.load({params:{start:0,limit:90}});}});var selectCompany=function(value){hourDS.baseParams.company_id=value.value;};var clearCompany=function(){hourDS.baseParams.company_id='';};var companyCombo=new Ext.form.ClearableComboBox({fieldLabel:'Company',emptyText:'(All Companies)',displayField:'company_name',valueField:'company_id',forceSelection:true,typeAhead:true,store:'companyStore',id:'company_id',triggerAction:'all',selectOnFocus:true,listeners:{'select':selectCompany,'cleared':clearCompany}});var hourGrid=new Ext.grid.EditorGridPanel({loadMask:true,stripeRows:true,border:false,autoSizeColumns:true,cellclick:function(){var record=hourGrid.getStore().getAt(rowIndex);var fieldName=hourGrid.getColumnModel().getDataIndex(columnIndex);var data=record.get(fieldName);Ext.MessageBox.alert('title','inside function');},autoWidth:true,autoScroll:true,clickstoEdit:1,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),height:300,store:hourDS,cm:hourColumnModel,border:false,autoExpandColumn:'Name',trackMouseOver:true,tbar:[companyCombo,'-',startDate,endDate,{text:'Generate Report',iconCls:'go',xtype:'button',handler:function(){hourDS.baseParams.startDate=startDate.value;hourDS.baseParams.endDate=endDate.value;hourDS.load({params:{start:0,limit:90}});}},'-',{text:'Add Timesheet',tooltip:'Click to Add a Timesheet',iconCls:'clock_add',handler:function(){winPanel=Ext.getCmp('winPanel');winPanel.show();}},'-',{text:'Delete Selected',tooltip:'Click to Delete selected row(s)',handler:handleDelete,iconCls:'clock_delete'},'-',{text:'Refresh',tooltip:'Click to Refresh the table',handler:refreshGrid,iconCls:'reload'},'-',{xtype:'button',text:'Print',id:'downloadpdf',tooltip:'Print Projects Report',icon:'images/icons/printer.png',enableKeyEvents:true,handler:basic_printGrid}],viewConfig:{emptyText:'No Days Off to Display'},view:new Ext.grid.GroupingView({forceFit:true,showGroupname:false,enableNoGroups:false,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),plugins:summary});hourGrid.addListener('afteredit',handleEdit);var scheduledate={xtype:'datefield',fieldLabel:'Date',name:'scheduledate',id:'scheduledate',format:'Y-m-d'};var projectStore=new Ext.data.JsonStore({id:'projectStore',url:'data.php',root:'results',baseParams:{xtable:'project',start:0,limit:10000,task:'showProjects'},fields:[{name:'project_id',type:'int'},{name:'project_name'}]});var userStore=new Ext.data.JsonStore({id:'userStore',url:'data.php',root:'results',baseParams:{xtable:'user',start:0,limit:10000,task:'showUsers'},fields:[{name:'user_id',type:'int'},{name:'username'}]});var userEdit=new Ext.form.ComboBox({id:'userEdit',triggerAction:'all',store:userStore,displayField:'username',valueField:'user_id',hiddenName:'user_id',labelSeparator:null,fieldLabel:'Employee:',listClass:'x-combo-list-small',allowBlank:false});var projectEdit=new Ext.form.ComboBox({id:'projectEdit',triggerAction:'all',store:projectStore,displayField:'project_name',valueField:'project_id',hiddenName:'project_id',labelSeparator:null,fieldLabel:'Project:',listClass:'x-combo-list-small',allowBlank:false});var hour_num=new Ext.form.TextField({name:'hour_num',fieldLabel:'Hours'});var dr=new Ext.FormPanel({frame:true,height:180,id:'dr',width:300,labelWidth:100,url:'data.php',baseParams:{xtable:'task',task:'addTimeSheet'},bodyStyle:'padding:5px',defaults:{labelWidth:100,width:170},defaultType:'datefield',items:[scheduledate,userEdit,projectEdit,hour_num],buttons:[{text:'Add Timesheet',handler:function(){dr.getForm().submit({success:function(f,a){Ext.Msg.alert('Success','Timesheet Successfully Created');winPanel.hide();},failure:function(f,a){Ext.Msg.alert('Warning','Timesheet Not Successfully Created');}});}},{text:'Cancel',handler:function(){winPanel.hide();}}]});var winPanel=Ext.getCmp('winPanel');if(!winPanel){winPanel=new Ext.Window({title:'Add Timesheet',id:'winPanel',autoHeight:true,width:310,resizable:false,closable:true,modal:true,closeAction:'hide',items:[dr]});}
winPanel.onClose=function(){winPanel.hide();}
var viewport=new Ext.Viewport({stateId:'viewport-stateid',stateful:true,layout:'border',defaults:{collapsible:false,split:true},items:[{region:'center',id:'centerpanel',layout:'fit',autoScroll:true,frame:false,border:false,items:[hourGrid]}]});function basic_printGrid(){global_printer=new Ext.grid.XPrinter({grid:hourGrid,pathPrinter:'./printer',pdfEnable:true,hasrowAction:false,localeData:{Title:'Wall Systems Supply',subTitle:'Payroll and Scheduling Systems - Days Off Report',footerText:'&copy 2010 - Wall Systems Supply, Priviledged and Confidential Information',pageNo:'Page # ',printText:'Print',closeText:'Close',pdfText:'PDF'},useCustom:{custom:false,customStore:null,columns:[],alignCols:[],pageToolbar:null,useIt:false,showIt:false,location:'bbar'},showdate:true,showdateFormat:'Y-F-d H:i:s',showFooter:true,styles:'default'});global_printer.prepare();};});Ext.onPrinting(function(){Ext.addStyleSheet("printer-friendly-array-grid.css");Ext.state.Manager.setProvider(new Ext.state.CookieProvider());new Ext.Panel({renderTo:"body",layout:"table",layoutConfig:{columns:1},border:false,bodyBorder:false,items:[new Ext.BoxComponent({el:'description'}),new Ext.ux.grid.PrinterGridPanel({store:hourStore,columns:hourColumnModel,stateId:'array-grid',title:'Array Grid'})]});});