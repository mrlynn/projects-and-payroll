
markerStore=new Ext.data.JsonStore({autoDestroy:true,autoLoad:true,url:'data.php',baseParams:{task:'getmaps'},storeId:'markerStore',root:'data',idProperty:'id',fields:['id','marker','lat','long']});Ext.onReady(function(){markerStore.on('load',function(){myMap=Ext.getCmp('my_map');markerStore.each(function(rec){var point=new GLatLng(rec.data.lat,rec.data.long);var mark=new GMarker(point,rec.data.marker);var mrk={lat:rec.data.lat,long:rec.data.long,title:rec.data.marker};var l=new Array();l['click']=function(e){var w=new Ext.Window({layout:'fit',closeAction:'hide',title:rec.data.marker,width:500,height:400,x:480,y:60,items:{xtype:'gmappanel',zoomLevel:0,gmapType:'panorama',setCenter:{lat:rec.data.lat,'lng':rec.data.long}},markers:[markerStore]});w.show();};myMap.addMarker(point,mrk,null,null,l);});});var panwin=new Ext.Window({layout:'fit',closeAction:'hide',title:'Street View of Brooklyn',width:500,height:400,x:480,y:60,items:{xtype:'gmappanel',gmapType:'panorama',zoomLevel:14,setCenter:{lat:40.648871,'lng':-74.020719}},markers:[markerStore]});var mapwin=new Ext.Window({layout:'fit',title:'GMap Window',closeAction:'hide',width:400,height:400,x:40,y:60,items:{xtype:'gmappanel',region:'center',zoomLevel:14,gmapType:'map',addControl:new GSmallMapControl(),setCenter:{geoCodeAddr:'5223 First Avenue, Brooklyn, NY 11232',marker:{title:'Wall Systems Supply'}}}});var showButton=new Ext.Button({id:'showButton',iconCls:'zoom',enableToggle:true,text:'Show Only Active',handler:function(){if(this.pressed){this.setText('Show All Projects');var mode='active'}else{this.setText('Show Only Active');var mode='all'}
markerStore.load({url:'data.php',method:'POST',params:{task:'getmaps',mode:mode}});}});new Ext.Viewport({title:'WSS Project Map',layout:'border',items:{xtype:'gmappanel',region:'center',zoomLevel:14,gmapType:'map',mapConfOpts:['enableScrollWheelZoom','enableDoubleClickZoom','enableDragging'],mapControls:['GSmallMapControl','GMapTypeControl','NonExistantControl'],id:'my_map',addControl:new GLargeMapControl(),setCenter:{geoCodeAddr:'5223 First Avenue, Brooklyn, NY 11232',marker:{title:'Wall Systems Supply'}},markers:[markerStore],tbar:[{text:'Brooklyn Street View',iconCls:'camera',handler:function(){panwin.show();}},showButton]}});});